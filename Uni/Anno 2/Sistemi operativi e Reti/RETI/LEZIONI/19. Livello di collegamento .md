## Introduzione
#### Cosa fa il livello di collegamento?
Trasferisce i datagrammi da un nodo a quello fisico adiacente lungo un collegamento diretto.

In parole semplici:
- Se due dispositivi (es. due switch o un PC e un router) sono **direttamente collegati**,  
    il **livello di collegamento** si occupa di **trasferire i dati da uno all'altro** su quel tratto.
- Il livello 2 **non si occupa di tratte lunghe**, ma **solo del tratto locale** tra due dispositivi **fisicamente vicini**.

### 📚 Terminologia
##### 🔹 **Nodi**
- Qualsiasi entità connessa alla rete: host, router, switch, ecc.

##### 🔹 **Collegamenti (link)**
- Sono i **canali di comunicazione** tra nodi **adiacenti**.
- Possono essere:
    - **Cablati** (es. Ethernet, fibra)
    - **Wireless** (es. Wi-Fi, LTE)
    - All’interno di **LAN** o WAN.

##### 🔹 **Frame**
- È il **pacchetto del livello 2**.
- Un frame **incapsula** (cioè contiene) un **datagramma IP** (che è di livello 3).
- Include anche informazioni per l’indirizzamento locale (es. MAC address), controllo errori, ecc.


## Esempio visivo
![[Pasted image 20250508220220.png]]


### 🔁 Collegamenti multipli = protocolli diversi
Quando un pacchetto IP (livello 3) viaggia da un dispositivo all'altro, non viaggia tutto su un solo collegamento, ma attraversa diversi link fisici, come:
- **Wi-Fi** tra il laptop e il router di casa
- **Ethernet** tra il router e il modem
- **Fibra** tra il modem e l’ISP

➡️ **Ogni tratto è gestito da un protocollo di collegamento diverso.**

### 🧠 Cosa implica?
###### 1. Diversi protocolli di livello 2
- Ogni link (collegamento) ha il suo **proprio "modo di incapsulare e trasmettere" il pacchetto**.
- Il datagramma IP viene **incapsulato in frame differenti** a seconda del tratto:
    - In casa: frame Wi-Fi
    - Verso l’ISP: frame Ethernet o PPP
    - Tra router backbone: frame MPLS, ATM, ecc.

###### 2. Servizi diversi
- Alcuni protocolli offrono:
    - **Affidabilità** (con ritrasmissioni, rilevamento errori) → es: Ethernet.
    - Altri no (es: Wi-Fi può essere meno affidabile, dipende dal livello MAC).
- Quindi, **non tutti i link sono "uguali" in qualità e servizi**.

![[Pasted image 20250508221724.png|center]]
Nella figura:
- I dispositivi in casa si collegano al router via **Wi-Fi**.
- Il router è collegato al modem o a un altro nodo via **Ethernet**.
- Da lì, il pacchetto viaggia verso Internet attraverso **altri router**.


![[Pasted image 20250508221336.png]]


## Servizi offerti dal livello di collegamento
##### 1. **Framing**
> Il **frame** è l’unità di trasmissione a livello 2.

- Il **datagramma IP (livello 3)** viene **incapsulato in un frame**.
- Il frame ha:
    - Una **intestazione (header)** → contiene, ad esempio, indirizzi MAC
    - Un **trailer (coda)** → può includere un checksum o codice CRC per controllo errori

📦 È come mettere un pacco in una scatola con etichetta per spedirlo su un tratto specifico.


##### 2. **Accesso al collegamento**
> Serve a controllare **chi può usare il mezzo trasmissivo** in un dato momento.

- In reti con **mezzo condiviso** (es. Wi-Fi, LAN con hub), più dispositivi vogliono trasmettere → serve un **protocollo MAC** (Medium Access Control).
    - Es: CSMA/CD in Ethernet, CSMA/CA in Wi-Fi
    
- Viene gestito tramite:
    - **Indirizzi MAC** → identificano **mittente e destinatario locali** (non sono indirizzi IP!)
    - Usati nei frame per capire **a chi è destinato** il pacchetto sul collegamento

🎯 Obiettivo: evitare collisioni e gestire l’accesso al mezzo fisico.


##### 3. **Consegna affidabile tra nodi adiacenti**
> Il livello 2 può **rilevare o correggere errori** nella trasmissione.

- **Non è obbligatorio**: dipende dal tipo di collegamento.
- **Non si usa** con collegamenti affidabili (es. Ethernet su fibra).
- **Utile invece su canali wireless**, dove gli errori sono frequenti:
    - Wi-Fi, cellulare → usano **ritrasmissioni locali**, controllo CRC, codifica FEC...

💡 Meglio **correggere localmente** gli errori tra nodi vicini, piuttosto che lasciare che **il livello di trasporto (es. TCP)** debba rispedire tutto dal mittente!


##### 4. **Controllo di flusso**
> Serve a **coordinare la velocità di trasmissione** tra il mittente e il ricevente **adiacenti**.

- Se il mittente invia dati troppo velocemente, il ricevente potrebbe **perdere pacchetti**.
- Il livello di collegamento può applicare **meccanismi per rallentare o fermare temporaneamente** il mittente.

📥 Es: in Ethernet, può esserci il meccanismo **PAUSE frame** per bloccare il traffico in ingresso.


##### 5. **Rilevazione e correzione degli errori**
> I dati su un collegamento possono essere **alterati da rumore o attenuazione** del segnale.  
> Il ricevente può rilevare e/o correggere questi errori.

Due strategie:
1. **ARQ (*Automatic Repeat reQuest*)**
	- Se rileva un errore, il ricevente **chiede la ritrasmissione** del pacchetto.
		- Molto usato in Wi-Fi, protocollo PPP…

2. **FEC (*Forward Error Correction*)**
	- Il mittente **aggiunge informazioni ridondanti** nel pacchetto (es. codici Reed-Solomon).
	- Il ricevente può **correggere l’errore da solo**, **senza chiedere ritrasmissioni**.
		- Il ricevente **corregge** errori direttamente usando dati extra.
			- Usato in contesti dove le **ritrasmissioni sono costose** o impossibili (es. streaming video, satelliti, VoIP...).

💡 **ARQ = reazione**, **FEC = prevenzione**.


##### 6. **Half-duplex vs Full-duplex**
![[Pasted image 20250508223000.png]]
- Wi-Fi è **half-duplex**: trasmette o riceve, non entrambi insieme.    
- Ethernet moderno (su switch) è **full-duplex**.

📶 Questo incide su prestazioni, latenza e gestione delle collisioni.



## Dove si trova il livello di collegamento in un host?
> È implementato **dall'adattatore di rete**, cioè dalla **scheda di rete** (in inglese: **NIC – Network Interface Card**).

- Ogni dispositivo connesso in rete ha una scheda di rete, che può essere:
    - Integrata (su scheda madre)
    - Esterna (USB, PCI)
    - Wireless (Wi-Fi) o cablata (Ethernet)

#### ⚙️ **Cosa fa la scheda di rete (NIC)?**
###### Implementa:
1. **Livello fisico (physical)** → converte i bit in segnali elettrici o radio.
2. **Livello di collegamento (link)** → costruisce e interpreta **frame**, applica MAC, rileva errori…

🔁 La scheda lavora quindi tra **livello 1 e 2 del modello ISO/OSI**.

#### 🖥️ **Come comunica con il resto del sistema?**
- La NIC è collegata al **bus del sistema (es. PCI)**.
- Questo bus collega la **CPU**, la **memoria** e le **periferiche**, tra cui appunto la NIC.


#### Rappresentazione
![[Pasted image 20250508223538.png|center|400]]
- Le frecce blu mostrano il flusso dei dati.
- Il controller gestisce gli accessi tra la CPU e la scheda.
- I pacchetti passano dal livello applicazione (in alto) → verso il basso → NIC → rete.


#### 🔧 **Come è fatta la NIC internamente?**
- È una **combinazione di hardware, software e firmware**.
    - **Hardware**: circuiti che gestiscono segnale, porta fisica, buffer.
    - **Firmware**: codice che gira nella NIC per gestire il MAC, frame, CRC...
    - **Driver software**: il sistema operativo usa driver per interagire con la NIC.



### Adattatore di rete negli host
Immaginiamo questa struttura 
![[Pasted image 20250508224151.png]]
dove abbiamo
- due host
	- mittente
	- ricevente

- in entrambi
	- La parte **in alto** è la **CPU + memoria** = software dei livelli superiori
	- La parte **in basso** è l'**adattatore di rete**, che gestisce:
	    - **Livello di collegamento (link)**
	    - **Livello fisico (physical)**

##### 🔄 **Lato mittente: cosa fa il controller NIC**
1. Riceve dalla CPU il **datagramma IP** (livello 3).
2. **Incapsula** il datagramma in un **frame**:
    - Aggiunge **header** con indirizzi MAC
    - Aggiunge **bit di controllo** per errori (CRC, checksum)
    
3. Applica:
    - **Controllo di flusso** (per non saturare il ricevente)
    - **Consegna affidabile** (se prevista)
    - **Accesso al mezzo** (decide quando trasmettere)
4. Passa il frame al **livello fisico** per trasmetterlo sul cavo o via radio.

##### 📥 **Lato ricevente: cosa fa il controller NIC**
1. Riceve il **segnale fisico** (bit stream) e lo converte in un **frame**.
2. **Verifica** se ci sono errori (CRC).
3. Se abilitato:
    - Effettua **ritrasmissione/controllo errori**
    - Applica **controllo di flusso**
4. **Estrae il datagramma IP** dal frame.
5. Lo passa alla **CPU**, che lo consegna al **livello 3 (network)**.

>[!tip]- NOTA
>La CPU **non fa direttamente tutto il lavoro del livello 2**:
>
>- Gestisce solo le **interazioni con la NIC**, come:
>    
>    - Assemblaggio delle info di indirizzamento (MAC)
>        
>    - Scelte politiche sul trattamento degli errori
>        
>- Tutto il resto (trasferimento, codifica, controllo errori) è **delegato alla scheda di rete**, che è **hardware + firmware dedicato**.