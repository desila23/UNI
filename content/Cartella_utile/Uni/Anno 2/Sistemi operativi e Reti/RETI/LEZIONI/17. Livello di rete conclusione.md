### 
## ICMP internet control message protocol
Ãˆ un protocollo usato perÂ comunicare informazioni di rete ma ==non viene considerato un protocollo di trasporto perchÃ© non Ã¨ usato dalle applicazioni di rete per trasferire i propri messaggi==.Â Â Â 

Serve sia agliÂ hostÂ che aiÂ routerÂ per scambiarsi messaggi legati al funzionamento della rete tipo:Â 
- Segnalazione di errori: ad esempio, quando un host o un router non Ã¨ raggiungibile, oppure se una porta o un protocollo non Ã¨ disponibile.Â 
- **Echo Request/Reply**: Ã¨ quello che usa il comandoÂ ping. Serve a verificare se un altro host Ã¨ raggiungibile e quanto tempo ci mette a rispondere.Â 

ICMP sta sopra il livello IP, i messaggi ICMP viaggiano dentro i datagrammi IP.Â 

### Struttura di un messaggio ICMP
![[content/Zphoto/Pasted image 20250506153447.png]]
Formato del messaggio:Â 
- **Tipo (8 bit)**: indica il tipo di messaggio (es. echo request, host non raggiungibileâ€¦)Â 
- **Codice (8 bit)**: dettaglia il tipo (es. se lâ€™host non raggiungibile Ã¨ down, oppure câ€™Ã¨ un problema di instradamentoâ€¦)Â 
- **Checksum (16 bit)**: serve a controllare se il messaggio Ã¨ arrivato integro.Â 
- IlÂ **resto dellâ€™intestazione**Â cambia a seconda del tipo di messaggio.Â 
- Infine ci sono (non sempre) alcuniÂ **dati**, usati per determinare il datagramma IP che ha causato il messaggio e determinare il processo corrispondente.

### Tipi di messaggi ICMP
Questi sono tutti i messaggi possibili, se scendi giÃ¹ c'Ã¨ un focus sui piÃ¹ utili

| Tipo | Codice | Descrizione                 | Utilizzo / Spiegazione                                                                             |
| ---- | ------ | --------------------------- | -------------------------------------------------------------------------------------------------- |
| 0    | 0      | Echo reply (ping)           | Risposta a una richiesta ping (tipo 8); il destinatario conferma la ricezione.                     |
| 3    | 0      | Destination unreachable     | Segnala che il pacchetto non puÃ² essere consegnato.                                                |
| 3    | 0      | Network unreachable         | Nessuna rete di destinazione raggiungibile. Potrebbe essere un router a inviarlo.                  |
| 3    | 1      | Host unreachable            | L'host specifico non Ã¨ raggiungibile (es. fallimento ARP).                                         |
| 3    | 2      | Protocol unreachable        | Protocollo IP non supportato dalla destinazione.                                                   |
| 3    | 3      | Port unreachable            | Porta della destinazione non aperta (es. nessun servizio in ascolto).                              |
| 3    | 4      | Fragmentation required      | Necessaria frammentazione ma non permessa (usato da **Path MTU Discovery**).                       |
| 3    | 6      | Network unknown             | La rete di destinazione Ã¨ sconosciuta (nessuna rotta).                                             |
| 3    | 7      | Host unknown                | L'host Ã¨ sconosciuto (indirizzo errato o non risolvibile).                                         |
| 4    | 0      | Source quench _(deprecato)_ | Un router congestionato richiedeva allâ€™host mittente di rallentare lâ€™invio. Ora **non piÃ¹ usato**. |
| 8    | 0      | Echo request (ping)         | Richiesta ping. Usata per verificare se un host Ã¨ attivo e raggiungibile.                          |
| 11   | 0      | TTL expired                 | Il pacchetto Ã¨ scaduto (TTL=0); usato da **traceroute** per identificare i router sul percorso.    |
### âœ… **Focus pratico sui messaggi piÃ¹ importanti:**
-  **Echo Request / Echo Reply (Tipo 8/0 e 0/0)**
	- Usati da `ping`.
		- Permettono di sapere se un host Ã¨ raggiungibile e misurare il tempo di risposta (RTT).
		- La risposta (tipo 0) contiene gli stessi dati della richiesta (tipo 8), utile per calcoli.

-  **Destination Unreachable (Tipo 3)**
	- Molto usato dai router o dagli host di destinazione per indicare problemi di raggiungibilitÃ .
	    - Es. tipo 3 codice 3 (porta non raggiungibile): succede quando invii UDP a una porta chiusa.
	    - Tipo 3 codice 4 (fragmentation required): usato quando il pacchetto Ã¨ troppo grande e il bit â€œdonâ€™t fragmentâ€ Ã¨ attivo â†’ utile per scoprire la MTU.

 - **Source Quench (Tipo 4)**
	- Permetteva al router di segnalare congestione â†’ ora **deprecato** e non piÃ¹ supportato nei protocolli moderni (sostituito da ECN).

 - **TTL Expired (Tipo 11)**
	- Fondamentale per il comando `traceroute`: ogni hop lungo il percorso invia questo messaggio quando il TTL arriva a 0.
	- Serve per â€œmappareâ€ i router intermedi tra sorgente e destinazione.

#### Focus su Traceroute e ICMP
![[content/Zphoto/Pasted image 20250506154538.png]]
La sorgente inviaÂ una serie di segmenti UDPÂ alla destinazione usando una porta "strana" che probabilmente non Ã¨ aperta. 
Invia un insieme di segmenti alla volta per avere piÃ¹ risposte insieme ad ogni hop e confrontare i tempi per capire se ci sono problemi oÂ ritardi variabili.Â 

##### Funziona cosÃ¬:Â 
- La sorgente invia segmenti UDP con `TTL=1`, il segmento puÃ² attraversareÂ solo 1 router, poi si ferma. 
	- Il router scarta il pacchetto (perchÃ© TTL Ã¨ finito) eÂ risponde con un messaggio ICMP "TTL expired"Â â†’ cosÃ¬ il computer scopreÂ chi Ã¨ il primo router.Â 

- Poi manda segmenti con `TTL=2`, si verifica la stessa cosa col router a cui arrivano -> il computer scopre anche ilÂ secondo routerÂ nel percorsoÂ 

- Si continua cosÃ¬ e ogni volta il computer tiene traccia degli IP router e del tempo impiegato.Â 

Quando i segmenti arrivano alla destinazione finaleÂ non viene piÃ¹ mandato un messaggio TTL expired ma dato che i pacchetti sono diretti a quella porta inesistente viene inviata la rispostaÂ ICMP tipo 3, codice 3 ("port unreachable")Â e il traceroute si ferma.Â 

Ogni volta che riceve una risposta ICMP, tracerouteÂ registra il tempoÂ tra invio e risposta e cosÃ¬ calcola ilÂ Round Trip TimeÂ (RTT) per ogni hop, ci dice quindi quali router attraversa un pacchetto per arrivare a destinazione e quanto tempo ci mette per ogni tratto.Â 

##### Nuova versione ICMP v6
Ãˆ la versione ICMP usata con IPv6, sono stati cambiati o ridefiniti alcuni codici. Ad esempio in IPv4 se un pacchetto era troppo grande e non poteva essere frammentato il router mandava `Destination Unreachable â€“ Fragmentation Required`;Â adesso questo messaggio Ã¨Â `Packet Too Big`.

### Gestione delle reti
Una rete Ã¨:
- un sistema formato da migliaia di componenti software e hardware che interagiscono tra loro
- viene anche chiamato **Sistema Autonomo**

>[!warning] Gestire e creare una rete Ã¨ estremamente difficile
> - serve pianificare
> - monitorare
> - gestire le risorse economiche in modo intelligente
#### Componenti che gestiscono la rete
- Server di gestione
	- Ãˆ il cervello del sistema.
	- Raccoglie, elabora e analizza le informazioni inviate dai dispositivi.
	- Invia comandi per configurare o modificare il comportamento dei dispositivi.
	- Coinvolge spesso **operatori umani**.

- Dispositivi di rete gestiti
	- Sono gli **switch, router, firewall, server**, ecc.
		- Hanno componenti hardware e software **configurabili** e **monitorabili**.
		- Ogni dispositivo ha un **agente** che comunica con il server.

- Dati
	- Rappresentano gli **â€œstatiâ€** del dispositivo:
		- **Configurazione**: es. indirizzo IP, assegnato dallâ€™amministratore.
		- **Dati operativi**: es. vicini OSPF, rilevati automaticamente.
		- **Statistiche**: es. traffico, errori, quanti pacchetti.

- Agente di gestione
	- Ãˆ il software **installato nel dispositivo gestito**.
	- Raccoglie e fornisce i dati di stato al server di gestione.
	- Riceve e applica i comandi del server.

- Protocollo di gestione di rete
	- Serve a **scambiare informazioni** tra server e dispositivi gestiti.
	- Il server lo usa per interrogare e comandare.
	- I dispositivi lo usano per inviare aggiornamenti e notifiche.
		- Esempi di protocolli: **SNMP**, **NetConf**, **RESTCONF**.
![[content/Zphoto/Pasted image 20250506155853.png]]
### Come si gestisce una rete?
Avviene in vario modo:Â 
1.Â **CLI (Command Line Interface)**Â 
	Ãˆ il metodo piÃ¹ diretto e classico.Â 
	Lâ€™operatore si collega (es. via SSH) al dispositivo e scrive comandi a riga di comando.Â 
	PuÃ² anche eseguire script da remoto.Â 
	Molti dispositivi hanno anche una interfaccia web, ma la CLI Ã¨ piÃ¹ potente e usata dai tecnici.Â 

2. **SNMP / MIB**Â 
	**SNMP** = *Simple Network Management Protocol*,Â Ã¨ unÂ protocolloÂ usato perÂ gestire e monitorare dispositivi di rete (router, switch, serverâ€¦)Â 
	**MIB**Â = *Management Information Base*, una specie di â€œdatabaseâ€ di oggetti gestibili.Â 
	
	Con SNMP, lâ€™operatore:Â 
		Interroga i dispositivi (es. â€œquanti pacchetti hai ricevuto?â€)Â 
		Oppure imposta valori (es. cambiare un parametro)Â 
	
	I dati sono organizzati nella MIB, che Ã¨ standardizzata.Â 
	
	SNMP Ã¨ molto usato per monitoraggio, ma poco per configurare.Â 

3. **NETCONF / YANG**Â 
	Ãˆ un approccio piÃ¹ moderno e astratto, si usa per configurare dispositivi, anche multipli, in modo centralizzato.Â 
	
	YANGÂ Ã¨ un linguaggio di modellazione datiÂ 
	
	NETCONFÂ Ã¨ il protocollo per comunicare azioni/dati compatibili con YANG a/da/tra dispositivi remoti

#### IN POCHE PAROLE
- con CLI vai proprio lÃ¬ manualmente pezzo per pezzo ecc...
- con SMNP+MIB aumenti l'astrazione ma comunque devi manualmente fare determinate operazioni di monitoraggio ecc solo che lo fai dal server di gestione
- con NETCONF+YANG Ã¨ tutto astratto e molto meno manuale
- 
### SNMP spiegato meglio con anche MIB 
![[content/Zphoto/GetImage - 2025-05-06T160540.745.png]]
SNMP ha due modalitÃ  di comunicazione coi dispositivi di rete:Â 
1. **ModalitÃ  richiesta/risposta (a sinistra)**Â 
	- IlÂ server di gestioneÂ invia unaÂ richiestaÂ a un dispositivo gestito (es. â€œquanti pacchetti hai ricevuto?â€).Â 
	- Il dispositivo risponde con unaÂ risposta SNMPÂ contenente i dati.Â 
	- Questo Ã¨ ilÂ modo piÃ¹ usatoÂ per raccogliere informazioni periodiche.Â 
	Ãˆ un meccanismoÂ attivo, parte dal server.Â 

2. Trap mode (a destra)Â 
	- Qui Ã¨ ilÂ dispositivo gestitoÂ che mandaÂ spontaneamente un messaggio â€œtrapâ€Â al server.Â 
	- Lo faÂ quando succede qualcosa di importanteÂ (es. un errore, unâ€™interfaccia che cadeâ€¦).Â 
	- Il server riceve il messaggio e puÃ² reagire.Â 
	Ãˆ un meccanismoÂ passivoÂ eÂ immediato, utile per allarmi o eventi.

==Oss. Importante==Â 
**Dispositivo gestito**: Ã¨ proprio il pezzo hardware tipo router/switchÂ 
**Agente(dati)**:Â Ã¨ una parte del software dentro al dispositivo gestito che parla col server di gestione usando SNMP. Ãˆ lui che fornisce dati, risponde, manda trap eccâ€¦

### SNMP spiegato meglio con anche MIB
- IÂ **dati di un dispositivo di rete**Â (sia operativi che di configurazione) sono organizzati inÂ **moduli MIB**.
- OgniÂ **modulo MIB**Â Ã¨ come un â€œfileâ€ che descrive un certo gruppo di informazioni (es. quelle relative a UDP).
    - Ne esistonoÂ **centinaia definiti dagli standard RFC**Â e moltissimi altri proprietari, forniti dai produttori di hardware.
- I dati sono definiti usando un linguaggio chiamatoÂ **SMI (Structure of Management Information)**. nella foto qua sotto puoi vedere come sono strutturate delle variabili MIB

La MIB Ã¨ come un â€œdizionarioâ€ di tutti i dati che un dispositivo di rete puÃ² rendere disponibili o modificabili via SNMP.
![[content/Zphoto/Pasted image 20250506161553.png]]

LaÂ **MIB ha una struttura ad albero**, gerarchica:
- Gli oggetti sonoÂ **nidificati**Â in rami (es.Â `system`Â â†’Â `sysDescr`,Â `sysUpTime`, ecc.).
- Ogni voce Ã¨Â **indicizzata da un OID**Â (Object Identifier), ad esempioÂ `.1.3.6.1.2.1.1.1`Â perÂ `sysDescr`. Questo vuol dire che quando chiedi un dato a un dispositivo con SNMP,Â **gli indichi un OID**Â per sapere esattamente quale parametro vuoi leggere o modificare. 
	- ğŸ“ Esempio: per sapere il nome del dispositivo, potresti chiedereÂ `.1.3.6.1.2.1.1.5`Â (che corrisponde aÂ `sysName`).
![[content/Zphoto/Pasted image 20250506161845.png]]

#### Tipi di messaggio SNMP
Questi messaggi quindi vengono usati tipo per dire
"Dimmi quanti pacchetti UDP hai ricevuto"

|Tipo|Da... â†’ A...|A cosa serve|
|---|---|---|
|GetRequest|Manager â†’ Agente|Leggere un valore specifico|
|GetNextRequest|Manager â†’ Agente|Navigare nella MIB|
|GetBulkRequest|Manager â†’ Agente|Ottenere piÃ¹ dati in un colpo solo|
|SetRequest|Manager â†’ Agente|Scrivere/aggiornare valori|
|Response|Agente â†’ Manager|Rispondere a una richiesta|
|Trap|Agente â†’ Manager|Segnalare un evento inaspettato|

#### Formati dei messaggi SNMP
![[content/Zphoto/Pasted image 20250506162005.png]]

#### âœ… Tipi di messaggi 0,1,2,3 (per get/set):
- **Request ID**: per abbinare richiesta e risposta.
- **Error Status e Index**: indicano se qualcosa Ã¨ andato storto (es. oggetto inesistente).
- **Name / Value**: la variabile da leggere o scrivere, con il suo valore.

#### ğŸ”” Tipo 4 (Trap):
- Usato dai dispositivi per **inviare messaggi spontanei** al server (eventi).
- Include info come:
    - tipo di trap
    - **OID dellâ€™evento** (es. â€œlink downâ€)
    - **indirizzo IP dellâ€™agente**
    - **timestamp**
    - **variabili coinvolte**
ğŸ“Œ Le trap sono fondamentali per **monitoraggio in tempo reale**: avvisano il server quando accade qualcosa (es. porta di rete disconnessa).


### NETCONF 
Ãˆ un protocollo pensato per configurareÂ attivamenteÂ i dispositivi in modo strutturato e automatizzabile. Ãˆ piÃ¹ moderno e potente rispetto a SNMP.Â 

Opera tra il server di gestione e i dispositivi di rete gestiti, puÃ²:Â 
- Leggere datiÂ dal dispositivo (`retrieve`)Â 
	
- Imposta o modificaÂ configurazioni (`set`, `modify`)Â 
    
- Attivare le configurazioniÂ (`activate`)Â 
    
- SupportaÂ **commit atomico**
	- tutte le modifiche vengono applicateÂ **insieme**, oppureÂ **nessuna viene applicata**Â se câ€™Ã¨ un errore.
	- PuÃ² ancheÂ **interrogare statistiche**, ricevereÂ **notifiche**, ecc.
    
- Usa ilÂ **modello RPC (Remote Procedure Call)**:
    - il server invia richieste XML â†’ il dispositivo risponde conÂ `<rpc-reply>`.
	
- Usa come protocollo di trasporto affidabile
    - SSH o TLS


#### Operazioni tipiche di NETCONF

| Operazione              | Funzione                                                                     |
| ----------------------- | ---------------------------------------------------------------------------- |
| `<get-config>`          | Legge la configurazione corrente (es. quella in esecuzione, detta `running`) |
| `<get>`                 | Legge i dati **operativi** (es. traffico, stato delle interfacce)            |
| `<edit-config>`         | Modifica una parte della configurazione                                      |
| `<lock>` / `<unlock>`   | Blocca/sblocca la configurazione per evitare conflitti da altre fonti        |
| `<create-subscription>` | Permette di ricevere notifiche automatiche (`<notification>`)                |

##### Esempio di scambi NETCONF in XML
Il dialogo tipico tra server e dispositivo segue questi passaggi:
1. `<hello>`: scambio iniziale di capability.
2. Scambio di richieste `<rpc>` e risposte `<rpc-reply>`.
3. Ricezione eventuale di `<notification>` (es. eventi, cambiamenti).
4. Chiusura della sessione con `<close-session>`.
![[content/Zphoto/Pasted image 20250506162609.png]]
â¡ï¸ Tutti i messaggi sono in formato XML.

##### Esempio concreto in XML
![[content/Zphoto/Pasted image 20250506162622.png]]

##### YANG (usato con NETCONF) 
Ãˆ un linguaggio di modellazione dati, serve per :Â 
- Definire come sono fatti i datiÂ 
- Specificare la struttura, la sintassi e il significato dei dati usati per configurare i dispositivi di rete conÂ NETCONFÂ 

In poche parole il produttore del dispositivo crea uno schema YANG che specifica 
- i parametri configurabili
- come devono essere scritti i dati
- i tipi di dato (interi, stringheâ€¦)
- le regole (valore minimo obbligatorio, massimo eccâ€¦). 
Questo schema YANG viene usato dal softwareÂ NETCONFÂ per generare i messaggi XML nel formato corretto e controllare che siano validi in base a tutte le cose scritte dal produttore.Â 

Serve per rendere il tutto "chiaro" e automatizzabile.
![[content/Zphoto/GetImage - 2025-05-06T162839.409.png]]
![[content/Zphoto/GetImage - 2025-05-06T162847.629.png]]